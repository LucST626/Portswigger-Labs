Lab: Blind SQL injection with conditional responses

游꿢 Objetivo

Extraer la contrase침a del usuario administrator mediante una inyecci칩n SQL ciega, utilizando las respuestas condicionales de la aplicaci칩n.

- Identificaci칩n del Vector (El "Or치culo")

En este laboratorio, la vulnerabilidad no est치 en la URL, sino en la cookie TrackingId.
El servidor hace algo como esto: 

 SELECT TrackingId FROM tracking WHERE TrackingId = '[VALOR_COOKIE]'

Si la consulta devuelve un resultado: La p치gina muestra el mensaje "Welcome back!".

Si la consulta no devuelve nada: El mensaje "Welcome back!" desaparece.

Este mensaje ser치 nuestro "Or치culo" para saber si nuestras preguntas de S칈/NO son ciertas.

- Confirmaci칩n de la Vulnerabilidad

Modificamos la cookie en Burp Suite:

image:img/SQL-11.1.png[]

 TrackingId=xyz' AND '1'='1 -> Aparece "Welcome back!".

image:img/SQL-11.2.png[]

 TrackingId=xyz' AND '1'='2 -> No aparece "Welcome back!".

image:img/SQL-11.3.png[]

-Pasos de la Explotaci칩n

A. Verificar que existe el usuario administrator

 TrackingId=xyz' AND (SELECT 'a' FROM users WHERE username='administrator')='a 

image:img/SQL-11.4.png[]

Welcome back! = existe el usuario.

B. Determinar la longitud de la contrase침a

Probamos diferentes n칰meros hasta que el mensaje desaparezca:

 TrackingId=xyz' AND (SELECT 'a' FROM users WHERE username='administrator' AND LENGTH(password)>19)='a 

image:img/SQL-11.5.png[]

(Si con 19 sale el mensaje y con 20 no, la contrase침a mide 20 caracteres).

C. Extraer la contrase침a letra a letra

Aqu칤 usamos SUBSTR. Probamos para la posici칩n 1 todas las letras y n칰meros:

 TrackingId=xyz' AND (SELECT SUBSTR(password,1,1) FROM users WHERE username='administrator')='a

image:img/SQL-11.6.png[]

La primera letra en este caso es 'l'

- Automatizaci칩n con Burp Intruder

Hacer esto a mano para 20 caracteres es demasiado lento. Usamos el Intruder:

Manda la petici칩n al Intruder.

Marca la posici칩n de la letra y el valor a probar: ...SUBSTR(password,춶1춶,1)='춶a춶'

image:img/SQL-11.7.png[]

Payload 1 (Posici칩n): N칰meros del 1 al 20.

Payload 2 (Car치cter): Lista de a-z y 0-9.

Grep - Match: Configura Burp para buscar la cadena "Welcome back!".

image:img/SQL-11.8.png[]

La paciencia a veces es una gran virtud...


image:img/SQL-11.9.png[]

Al final, ordenas los resultados y ver치s qu칠 letra dio "Verdadero" para cada posici칩n.