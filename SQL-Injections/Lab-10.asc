Lab: SQL injection UNION attack, retrieving multiple values in a single column

üéØ Objetivo

Extraer los nombres de usuario y contrase√±as de la tabla users combin√°ndolos en una sola columna, debido a que la consulta original solo permite mostrar texto en un √∫nico campo.

- An√°lisis de Columnas

Primero, determinamos el n√∫mero de columnas y cu√°les aceptan texto:

Contar columnas: ' ORDER BY 2-- (hay 2 columnas).

Probar tipos:

 ' UNION SELECT 'abc', NULL-- -> Error 

(La columna 1 no es de texto).

 ' UNION SELECT NULL, 'abc'-- -> √âxito 

(La columna 2 es la √∫nica que muestra texto).

- T√©cnica: Concatenaci√≥n de Cadenas

Como solo podemos usar la columna 2, debemos "pegar" el nombre de usuario y la contrase√±a en un solo string.
Usaremos un separador para poder distinguir d√≥nde termina uno y empieza el otro.

Sintaxis seg√∫n el motor: En PostgreSQL, el operador de concatenaci√≥n es ||.

Payload sugerido:

 ' UNION SELECT NULL, username || '~' || password FROM users--

image:img/SQL-10.1.png[]

NULL: Ocupa la columna 1 (que es num√©rica).

username || '~' || password: Junta el usuario, un separador tilde y la contrase√±a en la columna 2.

FROM users: Indica la tabla de origen.

- Ejecuci√≥n y Resultados

Al ejecutar el payload, la p√°gina mostrar√° una lista de resultados en la columna donde antes estaban las descripciones de los productos:

administrator~s3cr3tp4ssword

wiener~peter

carlos~montoya

- Resoluci√≥n final

Localizamos la l√≠nea que contiene a administrator.

Copiamos la cadena que aparece despu√©s de nuestro separador (~).

Iniciamos sesi√≥n en "My account".

image:img/SQL-9.2.png[]

¬øPor qu√© usamos un separador raro como ~?

Si el nombre de usuario fuera admin y la contrase√±a istrator, y no usas separador, ver√≠as administrator. No sabr√≠as d√≥nde acaba uno y empieza el otro. El separador evita confusiones.