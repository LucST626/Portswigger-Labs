Lab: SQL injection attack, querying the database type and version on MySQL and Microsoft

 Objetivo
Extraer la cadena que indica la versi贸n de la base de datos (MySQL o Microsoft) rompiendo el filtro de categor铆a mediante un ataque UNION.

1. An谩lisis Inicial (Enumeraci贸n)
Para que el ataque UNION funcione, primero debemos saber cu谩ntas columnas devuelve la consulta original.

Paso A: Determinar el n煤mero de columnas Inyectamos ORDER BY en el par谩metro category: ' ORDER BY 1# (Funciona)

image:img/SQL-4.1.png[]

 ' ORDER BY 2# (Funciona)

image:img/SQL-4.2.png[] 

 ' ORDER BY 3# (Da error) 

image:img/SQL-4.3.png[]

 Resultado: La consulta tiene 2 columnas.

Paso B: Verificar tipos de datos Confirmamos que ambas columnas aceptan texto:

image:img/SQL-4.4.png[]

2. Explotaci贸n (Extracci贸n de versi贸n)

A diferencia de Oracle, MySQL y MSSQL permiten consultar constantes o variables globales sin necesidad de una tabla como DUAL.

Payload utilizado: [source,sql]

' UNION SELECT @@version, NULL#

image:img/SQL-4.5.png[]

@@version: Variable global en MySQL y MSSQL que contiene la versi贸n del software.

NULL: Rellena la segunda columna para que la estructura coincida.

#: Comentario de MySQL para ignorar el resto de la consulta original.

3. Explicaci贸n T茅cnica

La consulta interna en el servidor se transform贸 de esto: SELECT name, description FROM products WHERE category = '[INPUT]'

A esto: SELECT name, description FROM products WHERE category = '' UNION SELECT @@version, NULL#

Al ser la primera parte de la consulta vac铆a (si seleccionas una categor铆a que no existe o cierras la comilla), la p谩gina muestra los resultados de la segunda consulta: La versi贸n de la base de datos.